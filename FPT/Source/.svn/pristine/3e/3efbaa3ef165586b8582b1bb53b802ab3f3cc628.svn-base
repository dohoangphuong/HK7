@model CSS_G06.Models.SearchDealer
@using CSS_G06.Models

@{
    List<DealerResult> tempObject = new List<DealerResult>();
}

<link href="~/Content/MyDefineStyle/AddAnAgreement.css" rel="stylesheet" />

<script type="text/javascript">
    $(document).ready(function () {
        $("#txtDealerCode").keydown(function (e) {
            if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
                (e.keyCode == 65 && (e.ctrlKey === true || e.metaKey === true)) ||
                (e.keyCode >= 35 && e.keyCode <= 40)) {
                return;
            }
            if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                e.preventDefault();
            }
        });
    });

    var isSelectedSelectDealer = false;

    function saveDealer() {
        var selectDealer = document.getElementById("lblMatchingDealer").textContent;
        var agreementNumber1 = '@Model.AgreementNumber';
        var variantNumber1 = '@Model.VariantNumber';
        if (selectDealer.length < 17) // default: "Matching dealer:"
        {
            document.getElementById("selectDealerSaveResultLable").innerText = "You should select at least one dealer for an agreement";
            return;
        }
        $.ajax({
            url: '@Url.Action("SaveDealer", "AddAnAgreement")',
            type: "GET",
            dataType: "json",
            data: { selectDealer: selectDealer, agreementNumber: agreementNumber1, variantNumber: variantNumber1 },
            success: function (data) {
                isSelectedSelectDealer = true;
                document.getElementById("LabelselectDealerSaveResult").innerText = data;
            },
            error: function (data) {
                document.getElementById("LabelselectDealerSaveResult").innerText = data;
            }
        });
    }

    function goFowardSelectDealer() {
        if (isSelectedSelectDealer == true) {
            goFoward();
            var agreementNumber1 = '@Model.AgreementNumber';
            var variantNumber1 = '@Model.VariantNumber';
            $.ajax({
                url: '@Url.Action("VolumeBanding", "AddAnAgreement")',
                type: "GET",
                dataType: "text",
                data: { agreementNumber: agreementNumber1, variantNumber: variantNumber1 },
                success: function (data) {
                    $('#uc2_4').html(data);
                },
                error: function (data) {
                    alert("Failed to load 'Volume banding'!");
                }
            });
        }
        else {
            alert("You must be selected least 1 dealer for agreement");
        }
    }

</script>

<style>
    #SelectApplicableDealer{
        width:800px;
        height:450px;
    }
    #SelectDealerInputSearchArea{
        height:100px;
        width:100%;
    }
    #SelectDealerContentResultArea{
        height:295px;
        width:100%;
    }
    #SelectDealerSubmitArea{
        height:25px;
        width:100%;
    }
    #SelectDealerSaveResult{
        height:30px;
        width:100%;
    }
    .labelAreaEdit{
        width: 100px;
        height: auto;
        font-size: 12px;
        font-weight: bold;
    }
    td{
        padding:2px;
    }
</style>

<div id="SelectApplicableDealer">
    @using (Ajax.BeginForm("SelectAplicableDealerSearch", "AddAnAgreement",
                new AjaxOptions { UpdateTargetId = "SelectDealerContentResultArea", HttpMethod = "POST"}))
   {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true)
        <div id="SelectDealerInputSearchArea">
            <table>
                <tr>
                    <td class="labelAreaEdit">Dealer code</td>
                    <td class="inputAreaShort">
                        @Html.HiddenFor(model => model.AgreementNumber)
                        @Html.HiddenFor(model => model.VariantNumber)
                        @Html.TextBoxFor(model => model.DealerCode, new { maxlength = 10, id = "txtDealerCode", style = " width: 200px;height: 25px;font-size: 12px;font-weight: normal;border: 1px solid #889EC7;border-radius: 2px;color: black;" })
                    </td>
                </tr>
                <tr>
                    <td class="labelAreaEdit">Dealer name</td>
                    <td class="inputAreaShort">
                        @Html.TextBoxFor(model => model.DealerName, new { maxlength = 30, id = "txtDealerName", style = " width: 200px;height: 25px;font-size: 12px;font-weight: normal;border: 1px solid #889EC7;border-radius: 2px;color: black;" })

                    </td>
                </tr>
                <tr>
                    <td class="labelAreaEdit"></td>
                    <td class="inputAreaShort" align="left">
                        &raquo;<input type="submit" value="search" style="border:none;background:none;padding-right:10px;padding-left:0px;" />
                    </td>
                </tr>
            </table>
        </div><!-- End #SelectDealerInputSearchArea -->
   }
    <div id="SelectDealerContentResultArea">
        @Html.Partial("SearchDealerResult", tempObject)
    </div><!-- End #SelectDealerContentResultArea -->

    <div id="SelectDealerSubmitArea" align="right" style="padding:5px;">
        &raquo;<input type="button" value="save as draft" style="border:none;background:none;padding-right:10px;padding-left:0px;" onclick="saveDealer()" />
        &raquo;<input type="button" value="back" style="border:none;background:none;padding-right:10px;padding-left:0px;" onclick="goBackward()" />
        &raquo;<input type="button" value="next" style="border:none;background:none;padding-right:10px;padding-left:0px;" onclick="goFowardSelectDealer()" />
    </div><!-- End #SelectDealerSubmitArea -->

    <div id="SelectDealerSaveResult">
        <label id="LabelselectDealerSaveResult" style="font-size:12px; color:red; font-style:italic"></label>
    </div>

</div><!-- End #InputArea -->


