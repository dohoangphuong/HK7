@model CSS.ViewModels.SearchDealerModel

@{
    Layout = null;
}

<script type="text/javascript">
    $(document).ready(function () {
        $.ajax({
            type: "POST",
            url: "/Agreement/GetAllDealer",
            success: function (result) {
                $("#srchDealerResult").html(result);
            },
            error: function () {
                alert("Call ajax failed.");
            }
        });

        $("#ajaxSaveDealers").click(function () {
            var selectedDealers = $('#srchDealerResult input:checked');
            if (selectedDealers.length == 0)
                alert("Please select at least one dealer");
            else
            {
                var agrmtNumber = $("#agrmtNumber").val();
                var varNumber = $("#varNumber").val();
                var selectedValue = [];
                selectedDealers.each(function (){
                    selectedValue.push(this.value);
                });
                $.ajax({
                    type: "POST",
                    url: "/Agreement/SaveDealers",
                    traditional: true,
                    data: {
                        selectedDealers: selectedValue,
                        agreementNumber: agrmtNumber,
                        varriantNumber: varNumber
                    },
                    success: function (result) {
                        alert("Save success.");
                        $("#step-4").html(result);
                    },
                    error: function () {
                        alert("Call ajax failed.");
                    }
                });
            }
        });
    });
</script>

@using (Ajax.BeginForm("SearchDealer", "Agreement"
    , new AjaxOptions()
    {
        HttpMethod = "POST",
        UpdateTargetId = "srchDealerResult"
    }, new { @style = "height: 100%" }))
{
    @Html.AntiForgeryToken();
    @Html.HiddenFor(model => model.AgreementNumber, new { @id = "agrmtNumber" });
    @Html.HiddenFor(model => model.VarriantNumber, new { @id = "varNumber" });

    <div class="form-horizontal" style="height: 30%">
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="form-group">
            @Html.LabelFor(model => model.Code, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Code, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Code, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.DealerName, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.DealerName, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.DealerName, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="col-md-offset-2 col-md-10">
            <input type="submit" value="Search" class="btn btn-default">
        </div>
    </div>
    <div id="srchDealerResult" style="height: 60%"></div>
    <div class="actionBar" style="height: 10%">
        <input class="buttonNext" type="button" value="next" onclick="forward()" />
        <input class="buttonPrevious" type="button" value="back" onclick="backward()" />
        <input id="ajaxSaveDealers" class="buttonFinish" type="button" value="save as draft" />
    </div>
}
