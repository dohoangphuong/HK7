@model CSS_G06.Models.SelectCustomer
@using CSS_G06.Models

@{
    List<SelectCustomer> tempObject = new List<SelectCustomer>();
}
<link href="~/Content/MyDefineStyle/AddAnAgreement.css" rel="stylesheet" />
<link href="~/Content/MyDefineStyle/AddAnAgreement_CustomerSelect.css" rel="stylesheet" />

<script type="text/javascript">
    $(document).ready(function () {
        $("#createAgreement").click(function () {
            var selected = $("#SelectCustomerResultArea input[type='radio']:checked");
            var rfoNumber = selected.val();
            if (!rfoNumber) {
                alert("You must select least a customer to create agreement!");
                return;
            }
            if (parseInt(rfoNumber) > 0) {
                $.ajax({
                    url: '@Url.Action("CreateAgreement", "AddAnAgreement")',
                    type: "GET",
                    dataType: "json",
                    data: { RFONumber1: rfoNumber },
                    success: function (data) {
                        if (data.AgreementNumber > 0)
                        {
                            document.getElementById("AgreementNumber").value = data.AgreementNumber;
                            document.getElementById("AgreementVariant").value = data.VariantNumber;
                            $('#wizard').smartWizard('goForward');
                            var agreementNumber1 = data.AgreementNumber;
                            var variantNumber1 = data.VariantNumber;
                            $.ajax({
                                url: '@Url.Action("BasicAgreementDetails", "AddAnAgreement")',
                                type: "GET",
                                dataType: "text",
                                data: { agreementNumber: agreementNumber1, variantNumber: variantNumber1 },
                                success: function (data) {
                                    $('#uc2_2').html(data);
                                },
                                error: function (data) {
                                    alert("Failed to load 'Basic Agreement Details'!");
                                }
                            });
                        }
                        else
                            alert("Failed add a agreement to database!");
                    },
                    error: function (data) {
                        alert("Failed create agreement!");
                    }
                });
            }
        });
        $("#txtRFONumberSearchCustomer").keydown(function (e) {
            if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
                (e.keyCode == 65 && (e.ctrlKey === true || e.metaKey === true)) ||
                (e.keyCode >= 35 && e.keyCode <= 40)) {
                return;
            }
            if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                e.preventDefault();
            }
        });
    });
</script>

<div id="SelectCustomer">

    <div id="SearchArea">
          
        @using (Ajax.BeginForm("SelectCustomer", "AddAnAgreement",
            new AjaxOptions { UpdateTargetId = "SelectCustomerResultArea", HttpMethod = "POST"}))
        {
            @Html.AntiForgeryToken()
            @Html.ValidationSummary(true)
            @Html.HiddenFor(model => model.AgreementNumber, new { id="AgreementNumber"})
            @Html.HiddenFor(model => model.AgreementVariant, new { id="AgreementVariant"})         
            <table>
                <tr>
                    <td class="labelArea">RFO Number</td>
                    <td class="inputAreaShort">@Html.TextBoxFor(model => model.RFONumer, new { maxlength = 10, @class = "itemShort" , id="txtRFONumberSearchCustomer"})</td>
                </tr>
                <tr>
                    <td class="labelArea">Customer Type</td>
                    <td class="inputAreaLong">
                        @Html.DropDownListFor(model => model.CustomerType, new SelectList(ViewBag.CustomerType, "CustomerTypeId", "CustomerType1"), "All", new { @class = "itemLong" })
                    </td>
                </tr>
                <tr>
                    <td class="labelArea">Name</td>
                    <td class="inputAreaLong">@Html.TextBoxFor(model => model.Name, new { maxlength = 50, @class = "itemLong" })</td>
                </tr>
                <tr>
                    <td class="labelArea">Post Code</td>
                    <td class="inputAreaShort">@Html.TextBoxFor(model => model.PostCode, new { maxlength = 10, @class = "itemShort" })</td>
                </tr>
                <tr>
                    <td class="labelArea">Business Area</td>
                    <td class="inputAreaShort">
                        @Html.DropDownListFor(model => model.BusinessArea, new SelectList(ViewBag.BusinessArea, "Order", "ConfigValue"), new { @class = "itemShort" })
                    </td>
                </tr>
                <tr>
                    <td class="labelArea">Region</td>
                    <td class="inputAreaShort">
                        @Html.DropDownListFor(model => model.Region, new SelectList(ViewBag.Region, "RegionId", "RegionName"), "All", new { @class = "itemShort" })
                    </td>
                </tr>
                <tr>
                    <td class ="labelArea"></td>
                    <td class="inputAreaShort" align="left">
                        &raquo;<input type="submit" value="search" style="border:none;background:none;padding:0px;" />
                    </td>
                </tr>
            </table>
        }
    </div><!-- End #SearchArea -->

    <div id="SelectCustomerResultArea">
        @Html.Partial("SearchCustomerResult", tempObject)
    </div><!-- End #ResultArea -->

    <div id="SubmitArea" align="right" style="padding:5px;">
        &raquo;<input id="createAgreement" type="button" value="create agreement" style="border:none;background:none;padding:0px;" />
    </div><!-- End #SubmitArea -->

</div><!-- End #SelectCustomer -->